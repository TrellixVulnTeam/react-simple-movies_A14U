{"ast":null,"code":"import _slicedToArray from\"E:/react-project/react-simple-movies/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from\"react\";import useSWR from\"swr\";import MovieCard,{MovieCardSkeleton}from\"components/movies/MovieCard\";import{fetcher,tmdbAPI}from\"apiConfig/config\";import useDebounce from\"hooks/useDebounce\";import ReactPaginate from\"react-paginate\";import{v4}from\"uuid\";import Button from\"components/button/Button\";import useSWRInfinite from\"swr/infinite\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var itemsPerPage=20;var MoviePage=function MoviePage(){var _data$,_data;var _useState=useState(0),_useState2=_slicedToArray(_useState,2),pageCount=_useState2[0],setPageCount=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),itemOffset=_useState4[0],setItemOffset=_useState4[1];var _useState5=useState(1),_useState6=_slicedToArray(_useState5,2),nextPage=_useState6[0],setNextPage=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),filter=_useState8[0],setFilter=_useState8[1];var _useState9=useState(tmdbAPI.getMovieList(\"popular\",nextPage)),_useState10=_slicedToArray(_useState9,2),url=_useState10[0],setUrl=_useState10[1];var filterDebounce=useDebounce(filter,500);var handleFilterChange=function handleFilterChange(e){setFilter(e.target.value);};var _useSWRInfinite=useSWRInfinite(function(index){return url.replace(\"page=1\",\"page=\".concat(index+1));},fetcher),data=_useSWRInfinite.data,error=_useSWRInfinite.error,size=_useSWRInfinite.size,setSize=_useSWRInfinite.setSize;var movies=data?data.reduce(function(a,b){return a.concat(b.results);},[]):[];var loading=!data&&!error;var isEmpty=(data===null||data===void 0?void 0:(_data$=data[0])===null||_data$===void 0?void 0:_data$.results.length)===0;var isReachingEnd=isEmpty||data&&((_data=data[data.length-1])===null||_data===void 0?void 0:_data.results.length)<itemsPerPage;console.log(\"MoviePage ~ isReachingEnd\",isReachingEnd);useEffect(function(){if(filterDebounce){setUrl(tmdbAPI.getMovieSearch(filterDebounce,nextPage));}else{setUrl(tmdbAPI.getMovieList(\"popular\",nextPage));}},[filterDebounce,nextPage]);useEffect(function(){if(!data||!data.total_results)return;setPageCount(Math.ceil(data.total_results/itemsPerPage));},[data,itemOffset]);var handlePageClick=function handlePageClick(event){var newOffset=event.selected*itemsPerPage%data.total_results;setItemOffset(newOffset);setNextPage(event.selected+1);};return/*#__PURE__*/_jsxs(\"div\",{className:\"py-10 page-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex mb-10\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-1\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"w-full p-4 bg-slate-800 text-white outline-none\",placeholder:\"Type here to search...\",onChange:handleFilterChange})}),/*#__PURE__*/_jsx(\"button\",{className:\"p-4 bg-primary text-white\",children:/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-6 w-6\",fill:\"none\",viewBox:\"0 0 24 24\",stroke:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"})})})]}),loading&&/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-4 gap-10\",children:new Array(itemsPerPage).fill(0).map(function(){return/*#__PURE__*/_jsx(MovieCardSkeleton,{},v4());})}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-4 gap-10\",children:!loading&&movies.length>0&&movies.map(function(item){return/*#__PURE__*/_jsx(MovieCard,{item:item},item.id);})}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-10 text-center\",children:/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return isReachingEnd?{}:setSize(size+1);},disabled:isReachingEnd,className:\"\".concat(isReachingEnd?\"bg-slate-300\":\"\"),children:\"Load more\"})})]});};export default MoviePage;","map":{"version":3,"names":["React","useEffect","useState","useSWR","MovieCard","MovieCardSkeleton","fetcher","tmdbAPI","useDebounce","ReactPaginate","v4","Button","useSWRInfinite","itemsPerPage","MoviePage","pageCount","setPageCount","itemOffset","setItemOffset","nextPage","setNextPage","filter","setFilter","getMovieList","url","setUrl","filterDebounce","handleFilterChange","e","target","value","index","replace","data","error","size","setSize","movies","reduce","a","b","concat","results","loading","isEmpty","length","isReachingEnd","console","log","getMovieSearch","total_results","Math","ceil","handlePageClick","event","newOffset","selected","Array","fill","map","item","id"],"sources":["E:/react-project/react-simple-movies/src/pages/MoviePageV2.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport useSWR from \"swr\";\r\nimport MovieCard, { MovieCardSkeleton } from \"components/movies/MovieCard\";\r\nimport { fetcher, tmdbAPI } from \"apiConfig/config\";\r\nimport useDebounce from \"hooks/useDebounce\";\r\nimport ReactPaginate from \"react-paginate\";\r\nimport { v4 } from \"uuid\";\r\nimport Button from \"components/button/Button\";\r\nimport useSWRInfinite from \"swr/infinite\";\r\nconst itemsPerPage = 20;\r\n\r\nconst MoviePage = () => {\r\n  const [pageCount, setPageCount] = useState(0);\r\n  const [itemOffset, setItemOffset] = useState(0);\r\n  const [nextPage, setNextPage] = useState(1);\r\n  const [filter, setFilter] = useState(\"\");\r\n  const [url, setUrl] = useState(tmdbAPI.getMovieList(\"popular\", nextPage));\r\n  const filterDebounce = useDebounce(filter, 500);\r\n  const handleFilterChange = (e) => {\r\n    setFilter(e.target.value);\r\n  };\r\n  const { data, error, size, setSize } = useSWRInfinite(\r\n    (index) => url.replace(\"page=1\", `page=${index + 1}`),\r\n    fetcher\r\n  );\r\n  const movies = data ? data.reduce((a, b) => a.concat(b.results), []) : [];\r\n  const loading = !data && !error;\r\n  const isEmpty = data?.[0]?.results.length === 0;\r\n  const isReachingEnd =\r\n    isEmpty || (data && data[data.length - 1]?.results.length < itemsPerPage);\r\n  console.log(\"MoviePage ~ isReachingEnd\", isReachingEnd);\r\n  useEffect(() => {\r\n    if (filterDebounce) {\r\n      setUrl(tmdbAPI.getMovieSearch(filterDebounce, nextPage));\r\n    } else {\r\n      setUrl(tmdbAPI.getMovieList(\"popular\", nextPage));\r\n    }\r\n  }, [filterDebounce, nextPage]);\r\n  useEffect(() => {\r\n    if (!data || !data.total_results) return;\r\n    setPageCount(Math.ceil(data.total_results / itemsPerPage));\r\n  }, [data, itemOffset]);\r\n  const handlePageClick = (event) => {\r\n    const newOffset = (event.selected * itemsPerPage) % data.total_results;\r\n    setItemOffset(newOffset);\r\n    setNextPage(event.selected + 1);\r\n  };\r\n  return (\r\n    <div className=\"py-10 page-container\">\r\n      <div className=\"flex mb-10\">\r\n        <div className=\"flex-1\">\r\n          <input\r\n            type=\"text\"\r\n            className=\"w-full p-4 bg-slate-800 text-white outline-none\"\r\n            placeholder=\"Type here to search...\"\r\n            onChange={handleFilterChange}\r\n          />\r\n        </div>\r\n        <button className=\"p-4 bg-primary text-white\">\r\n          <svg\r\n            xmlns=\"http://www.w3.org/2000/svg\"\r\n            className=\"h-6 w-6\"\r\n            fill=\"none\"\r\n            viewBox=\"0 0 24 24\"\r\n            stroke=\"currentColor\"\r\n          >\r\n            <path\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeWidth=\"2\"\r\n              d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"\r\n            />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n      {/* {loading && (\r\n        <div className=\"w-10 h-10 rounded-full border-4 border-primary border-t-transparent border-t-4 mx-auto animate-spin\"></div>\r\n      )} */}\r\n      {loading && (\r\n        <div className=\"grid grid-cols-4 gap-10\">\r\n          {new Array(itemsPerPage).fill(0).map(() => (\r\n            <MovieCardSkeleton key={v4()}></MovieCardSkeleton>\r\n          ))}\r\n        </div>\r\n      )}\r\n      <div className=\"grid grid-cols-4 gap-10\">\r\n        {!loading &&\r\n          movies.length > 0 &&\r\n          movies.map((item) => (\r\n            <MovieCard key={item.id} item={item}></MovieCard>\r\n          ))}\r\n      </div>\r\n      <div className=\"mt-10 text-center\">\r\n        <Button\r\n          onClick={() => (isReachingEnd ? {} : setSize(size + 1))}\r\n          disabled={isReachingEnd}\r\n          className={`${isReachingEnd ? \"bg-slate-300\" : \"\"}`}\r\n        >\r\n          Load more\r\n        </Button>\r\n      </div>\r\n      {/* <div className=\"mt-10\">\r\n        <ReactPaginate\r\n          breakLabel=\"...\"\r\n          nextLabel=\"next >\"\r\n          onPageChange={handlePageClick}\r\n          pageRangeDisplayed={5}\r\n          pageCount={pageCount}\r\n          previousLabel=\"< previous\"\r\n          renderOnZeroPageCount={null}\r\n          className=\"pagination\"\r\n        />\r\n      </div> */}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MoviePage;\r\n"],"mappings":"0HAAA,MAAOA,MAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,MAAOC,OAAP,KAAmB,KAAnB,CACA,MAAOC,UAAP,EAAoBC,iBAApB,KAA6C,6BAA7C,CACA,OAASC,OAAT,CAAkBC,OAAlB,KAAiC,kBAAjC,CACA,MAAOC,YAAP,KAAwB,mBAAxB,CACA,MAAOC,cAAP,KAA0B,gBAA1B,CACA,OAASC,EAAT,KAAmB,MAAnB,CACA,MAAOC,OAAP,KAAmB,0BAAnB,CACA,MAAOC,eAAP,KAA2B,cAA3B,C,wFACA,GAAMC,aAAY,CAAG,EAArB,CAEA,GAAMC,UAAS,CAAG,QAAZA,UAAY,EAAM,kBACtB,cAAkCZ,QAAQ,CAAC,CAAD,CAA1C,wCAAOa,SAAP,eAAkBC,YAAlB,eACA,eAAoCd,QAAQ,CAAC,CAAD,CAA5C,yCAAOe,UAAP,eAAmBC,aAAnB,eACA,eAAgChB,QAAQ,CAAC,CAAD,CAAxC,yCAAOiB,QAAP,eAAiBC,WAAjB,eACA,eAA4BlB,QAAQ,CAAC,EAAD,CAApC,yCAAOmB,MAAP,eAAeC,SAAf,eACA,eAAsBpB,QAAQ,CAACK,OAAO,CAACgB,YAAR,CAAqB,SAArB,CAAgCJ,QAAhC,CAAD,CAA9B,0CAAOK,GAAP,gBAAYC,MAAZ,gBACA,GAAMC,eAAc,CAAGlB,WAAW,CAACa,MAAD,CAAS,GAAT,CAAlC,CACA,GAAMM,mBAAkB,CAAG,QAArBA,mBAAqB,CAACC,CAAD,CAAO,CAChCN,SAAS,CAACM,CAAC,CAACC,MAAF,CAASC,KAAV,CAAT,CACD,CAFD,CAGA,oBAAuClB,cAAc,CACnD,SAACmB,KAAD,QAAWP,IAAG,CAACQ,OAAJ,CAAY,QAAZ,gBAA8BD,KAAK,CAAG,CAAtC,EAAX,EADmD,CAEnDzB,OAFmD,CAArD,CAAQ2B,IAAR,iBAAQA,IAAR,CAAcC,KAAd,iBAAcA,KAAd,CAAqBC,IAArB,iBAAqBA,IAArB,CAA2BC,OAA3B,iBAA2BA,OAA3B,CAIA,GAAMC,OAAM,CAAGJ,IAAI,CAAGA,IAAI,CAACK,MAAL,CAAY,SAACC,CAAD,CAAIC,CAAJ,QAAUD,EAAC,CAACE,MAAF,CAASD,CAAC,CAACE,OAAX,CAAV,EAAZ,CAA2C,EAA3C,CAAH,CAAoD,EAAvE,CACA,GAAMC,QAAO,CAAG,CAACV,IAAD,EAAS,CAACC,KAA1B,CACA,GAAMU,QAAO,CAAG,CAAAX,IAAI,OAAJ,EAAAA,IAAI,SAAJ,gBAAAA,IAAI,CAAG,CAAH,CAAJ,wCAAWS,OAAX,CAAmBG,MAAnB,IAA8B,CAA9C,CACA,GAAMC,cAAa,CACjBF,OAAO,EAAKX,IAAI,EAAI,QAAAA,IAAI,CAACA,IAAI,CAACY,MAAL,CAAc,CAAf,CAAJ,sCAAuBH,OAAvB,CAA+BG,MAA/B,EAAwChC,YAD9D,CAEAkC,OAAO,CAACC,GAAR,CAAY,2BAAZ,CAAyCF,aAAzC,EACA7C,SAAS,CAAC,UAAM,CACd,GAAIyB,cAAJ,CAAoB,CAClBD,MAAM,CAAClB,OAAO,CAAC0C,cAAR,CAAuBvB,cAAvB,CAAuCP,QAAvC,CAAD,CAAN,CACD,CAFD,IAEO,CACLM,MAAM,CAAClB,OAAO,CAACgB,YAAR,CAAqB,SAArB,CAAgCJ,QAAhC,CAAD,CAAN,CACD,CACF,CANQ,CAMN,CAACO,cAAD,CAAiBP,QAAjB,CANM,CAAT,CAOAlB,SAAS,CAAC,UAAM,CACd,GAAI,CAACgC,IAAD,EAAS,CAACA,IAAI,CAACiB,aAAnB,CAAkC,OAClClC,YAAY,CAACmC,IAAI,CAACC,IAAL,CAAUnB,IAAI,CAACiB,aAAL,CAAqBrC,YAA/B,CAAD,CAAZ,CACD,CAHQ,CAGN,CAACoB,IAAD,CAAOhB,UAAP,CAHM,CAAT,CAIA,GAAMoC,gBAAe,CAAG,QAAlBA,gBAAkB,CAACC,KAAD,CAAW,CACjC,GAAMC,UAAS,CAAID,KAAK,CAACE,QAAN,CAAiB3C,YAAlB,CAAkCoB,IAAI,CAACiB,aAAzD,CACAhC,aAAa,CAACqC,SAAD,CAAb,CACAnC,WAAW,CAACkC,KAAK,CAACE,QAAN,CAAiB,CAAlB,CAAX,CACD,CAJD,CAKA,mBACE,aAAK,SAAS,CAAC,sBAAf,wBACE,aAAK,SAAS,CAAC,YAAf,wBACE,YAAK,SAAS,CAAC,QAAf,uBACE,cACE,IAAI,CAAC,MADP,CAEE,SAAS,CAAC,iDAFZ,CAGE,WAAW,CAAC,wBAHd,CAIE,QAAQ,CAAE7B,kBAJZ,EADF,EADF,cASE,eAAQ,SAAS,CAAC,2BAAlB,uBACE,YACE,KAAK,CAAC,4BADR,CAEE,SAAS,CAAC,SAFZ,CAGE,IAAI,CAAC,MAHP,CAIE,OAAO,CAAC,WAJV,CAKE,MAAM,CAAC,cALT,uBAOE,aACE,aAAa,CAAC,OADhB,CAEE,cAAc,CAAC,OAFjB,CAGE,WAAW,CAAC,GAHd,CAIE,CAAC,CAAC,6CAJJ,EAPF,EADF,EATF,GADF,CA8BGgB,OAAO,eACN,YAAK,SAAS,CAAC,yBAAf,UACG,GAAIc,MAAJ,CAAU5C,YAAV,EAAwB6C,IAAxB,CAA6B,CAA7B,EAAgCC,GAAhC,CAAoC,8BACnC,KAAC,iBAAD,IAAwBjD,EAAE,EAA1B,CADmC,EAApC,CADH,EA/BJ,cAqCE,YAAK,SAAS,CAAC,yBAAf,UACG,CAACiC,OAAD,EACCN,MAAM,CAACQ,MAAP,CAAgB,CADjB,EAECR,MAAM,CAACsB,GAAP,CAAW,SAACC,IAAD,qBACT,KAAC,SAAD,EAAyB,IAAI,CAAEA,IAA/B,EAAgBA,IAAI,CAACC,EAArB,CADS,EAAX,CAHJ,EArCF,cA4CE,YAAK,SAAS,CAAC,mBAAf,uBACE,KAAC,MAAD,EACE,OAAO,CAAE,yBAAOf,cAAa,CAAG,EAAH,CAAQV,OAAO,CAACD,IAAI,CAAG,CAAR,CAAnC,EADX,CAEE,QAAQ,CAAEW,aAFZ,CAGE,SAAS,WAAKA,aAAa,CAAG,cAAH,CAAoB,EAAtC,CAHX,uBADF,EA5CF,GADF,CAoED,CAxGD,CA0GA,cAAehC,UAAf"},"metadata":{},"sourceType":"module"}